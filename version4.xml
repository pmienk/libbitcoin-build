<?xml version = "1.0" ?>
<configuration language="en-us">

  <repository name="libbitcoin-system"
    version="4.0.0"
    email="eric@voskuil.org"
    description="Bitcoin Cross-Platform C++ Development Toolkit">

    <language id="C" />
    <language id="CXX" />

    <library
      name="bitcoin-system"
      uuid="39f60708-ff48-4c22-952d-43470866f684">

      <sources path="src" recursive="true" />
      <headers path="include" recursive="true" />

      <!-- Exposed knobs -->
      <option name="icu" type="with" default="no" comment="Build using ICU libraries." />
      <option name="avx2" type="enable" default="no" comment="Use Intel AVX2 intrinsics." />
      <option name="avx512" type="enable" default="no" comment="Use Intel AVX512 intrinsics." />
      <option name="sse41" type="enable" default="no" comment="Use SSE4.1 hardware instructions." />
      <option name="shani" type="enable" default="no" comment="Use Intel SHA Extensions." />

      <!-- Dependencies -->
      <dependency name="boost" version="1.86.0">
        <component name="iostreams" />
        <component name="locale" />
        <component name="program_options" />
        <component name="thread" />
        <component name="url" />
      </dependency>

      <dependency name="icu" version="55.2" option="icu">
        <component name="i18n" />
        <component name="uc" />
        <component name="data" />
      </dependency>

      <dependency name="secp256k1" version="0.7.0" />

      <!--
      <dependency name="pthread">
        <system exclude="android" />
      </dependency>

      <dependency name="dl" function="dlopen">
        <system required="linux" />
        </dependency>

      <dependency name="rt" function="clock_gettime">
        <system required="linux" />
        <system exclude="android" />
      </dependency>
      -->

      <compiler standard="20">
        <flag option="avx2"
          comment="Conditionally require avx2 intrinsics."
          compound="true"
          type="public">
          <context language="c" />
          <context language="c++" />
          <flag id="mavx" />
          <flag id="mavx2" />
          <program>
            <include header="stdint.h" />
            <include header="immintrin.h" />
            <loc>__m256i a = _mm256_set_epi32(8, 7, 6, 5, 4, 3, 2, 1);</loc>
            <loc>return _mm256_extract_epi32(_mm256_slli_epi64(a, 2), 5);</loc>
          </program>
        </flag>

        <flag option="avx512"
          comment="Conditionally require avx512 intrinsics."
          compound="true"
          type="public">
          <context language="c" />
          <context language="c++" />
          <flag id="mavx512f" />
          <flag id="mavx512bw" />
          <program>
            <include header="stdint.h" />
            <include header="immintrin.h" />
            <loc>__m512i a = _mm512_set_epi32(16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1);</loc>
            <loc>return _mm_extract_epi32(_mm512_extracti32x4_epi32(_mm512_slli_epi64(a, 2), 2), 1);</loc>
          </program>
        </flag>

        <flag option="shani"
          comment="Conditionally require sha native intrincis."
          compound="true"
          type="public">
          <context language="c" />
          <context language="c++" />
          <flag id="msse4" />
          <flag id="msha" />
          <program>
            <include header="stdint.h" />
            <include header="immintrin.h" />
            <loc>__m128i a = _mm_set1_epi32(0);</loc>
            <loc>__m128i b = _mm_set1_epi32(15);</loc>
            <loc>__m128i k = _mm_set1_epi32(31);</loc>
            <loc>return _mm_extract_epi32(_mm_sha256msg2_epu32(_mm_sha256msg1_epu32(_mm_sha256rnds2_epu32(a, b, k), b), a), 2);</loc>
          </program>
        </flag>

        <flag option="sse41"
          comment="Conditionally require sse4.1 intrinsics."
          compound="true"
          type="public">
          <context language="c" />
          <context language="c++" />
          <flag id="msse4.1" />
          <program>
            <include header="stdint.h" />
            <include header="immintrin.h" />
            <loc>__m128i a = _mm_set1_epi32(0);</loc>
            <loc>__m128i b = _mm_set1_epi32(15);</loc>
            <loc>return _mm_extract_epi32(_mm_add_epi64(a, b), 2);</loc>
          </program>
        </flag>

        <flag option="icu"
          comment="Use ICU libraries."
          id="-DWITH_ICU"
          type="public">
          <context language="c" />
          <context language="c++" />
        </flag>

        <flag id="Wall" />
        <flag id="Wextra" />
        <!-- <flag id="Wpedantic" /> -->
        <flag id="Wno-reorder" />
        <flag id="Wno-missing-field-initializers" />
        <flag id="Wno-missing-braces" />
        <flag id="Wno-comment" />
        <flag id="Wno-deprecated-copy" />
        <flag id="Wno-ignored-attributes" />
        <flag id="Wno-mismatched-tags" />
        <!-- <flag id="fvisibility=hidden" /> -->>
        <flag id="Wno-long-long" />
        <flag id="fno-var-tracking-assignments" />

      </compiler>

      <linkage>
        <flag id="no_fixup_chains" />
        <flag id="fstack-protector" />
        <flag id="fstack-protector-all" />
      </linkage>

    </library>

    <test name="bitcoin-system-test"
      option="test" type="with" default="yes"
      uuid="51a424a9-2c12-4211-8d40-e49d1534c541">

      <sources path="test" recursive="true" />

      <dependency name="boost" version="1.86.0" private="true">
        <component name="unit_test_framework" />
      </dependency>

      <dependency name="bitcoin-system" private="true" />

      <!-- <trigger test="t2" /> -->
    </test>

    <binary name="examples"
      option="examples" type="with" default="yes"
      install="false"
      uuid="b726df7d-6d1d-48fb-ac02-34eb45f9145e">

      <sources path="examples" />

      <dependency name="bitcoin-system" private="true" />
    </binary>

    <ci />
  </repository>

  <repository name="libbitcoin-network" 
    version="4.0.0"
    email="eric@voskuil.org"
    description="Bitcoin P2P Network Library">

    <language id="C" />
    <language id="CXX" />

    <library name="bitcoin-network"
      uuid="564eb540-d6b6-425c-b8db-b0bee8970c18">

      <sources path="src" recursive="true" />
      <headers path="include" recursive="true" includeroot="true" />
      <headers path="include/bitcoin/network/ssl" recursive="true" option="ssl" />

      <!-- Exposed knobs -->
      <option name="ssl" type="with" default="yes" comment="Use embedded ssl library." />

      <dependency name="bitcoin-system" version="4.0.0" />

      <compiler standard="20">
        <flag option="ssl"
          comment="Use embedded ssl libraries."
          compound="true"
          type="public">
          <flag id="-DWITH_SSL" />
          <flag id="-DWOLFSSL_USER_SETTINGS" />
          <context language="c" />
          <context language="c++" />
        </flag>

        <flag id="Wall" />
        <flag id="Wextra" />
        <!-- <flag id="Wpedantic" /> -->
        <flag id="Wno-reorder" />
        <flag id="Wno-missing-field-initializers" />
        <flag id="Wno-missing-braces" />
        <flag id="Wno-comment" />
        <flag id="Wno-deprecated-copy" />
        <flag id="Wno-mismatched-tags" />

      </compiler>

      <linkage>
        <flag id="no_fixup_chains" />
        <flag id="fstack-protector" />
        <flag id="fstack-protector-all" />
      </linkage>

    </library>

    <test name="libbitcoin-network-tests"
      option="test" type="with" default="yes"
      uuid="d28fc18a-8b81-4247-92ee-6967feefeeff">
      <sources path="test" recursive="true" />
      <compiler>
        <flag option="ssl"
          id="DCERT_PREFIX=&quot;\&quot;${src_dir}/test/ssl/wolfssl/wolfcrypt/test/\&quot;&quot;"
          comment="WolfSSL test data parameter."
          option="ssl"
          type="private" />
      </compiler>
    </test>

  </repository>

  <repository name="libbitcoin-database"
    version="4.0.0"
    email="eric@voskuil.org"
    description="Bitcoin High Performance Blockchain Database">

    <language id="C" />
    <language id="CXX" />

    <library name="bitcoin-database"
      uuid="62d7fbee-4d52-424a-8938-59756e13d9f5">

      <sources path="src" recursive="true" />
      <headers path="include" recursive="true" includeroot="true" />

      <dependency name="bitcoin-system" version="4.0.0" />

      <compiler standard="20">
        <flag id="Wall" />
        <flag id="Wextra" />
        <!-- <flag id="Wpedantic" /> -->
        <flag id="Wno-reorder" />
        <flag id="Wno-missing-field-initializers" />
        <flag id="Wno-missing-braces" />
        <flag id="Wno-comment" />
        <flag id="Wno-deprecated-copy" />
        <flag id="Wno-mismatched-tags" />
        <!-- <flag id="fvisibility=hidden" /> -->>
      </compiler>

      <linkage>
        <flag id="no_fixup_chains" />
        <flag id="fstack-protector" />
        <flag id="fstack-protector-all" />
      </linkage>

    </library>

    <test name="libbitcoin-database-tests"
      option="test" type="with" default="yes"
      uuid="5c4da53a-8c06-4da6-a2a8-3c30f338ed70">
      <sources path="test" recursive="true" />
    </test>

    <binary name="initchain"
      option="tools" type="with" default="yes"
      install="false"
      uuid="005f2a86-f937-4ab5-b041-0f21b67eec66">
      <sources path="tools/initchain" />
    </binary>

  </repository>

  <repository name="libbitcoin-node"
    version="4.0.0"
    email="eric@voskuil.org"
    description="Bitcoin Full Node">

    <language id="C" />
    <language id="CXX" />

    <library name="bitcoin-node"
      uuid="5ffb5f52-0772-4404-bb2f-39be5f82a158">

      <sources path="src" recursive="true" />
      <headers path="include" recursive="true" includeroot="true" />

      <dependency name="bitcoin-database" version="4.0.0" />
      <dependency name="bitcoin-network" version="4.0.0" />

      <compiler standard="20">
        <flag id="Wall" />
        <flag id="Wextra" />
        <!-- <flag id="Wpedantic" /> -->
        <flag id="Wno-reorder" />
        <flag id="Wno-missing-field-initializers" />
        <flag id="Wno-missing-braces" />
        <flag id="Wno-comment" />
        <flag id="Wno-deprecated-copy" />
        <flag id="Wno-mismatched-tags" />
        <!-- <flag id="fvisibility=hidden" /> -->>
      </compiler>

      <linkage>
        <flag id="no_fixup_chains" />
        <flag id="fstack-protector" />
        <flag id="fstack-protector-all" />
      </linkage>

    </library>

    <test name="libbitcoin-node-tests"
      option="test" type="with" default="yes"
      uuid="4bd50864-d3bc-4f64-aebb-ddeb8a622fa8">
      <sources path="test" recursive="true" />
    </test>

  </repository>

  <repository name="libbitcoin-server"
    version="4.0.0"
    email="eric@voskuil.org"
    description="Bitcoin Full Node and Query Server">

    <language id="C" />
    <language id="CXX" />

    <library name="bitcoin-server"
      uuid="73ce0ac2-ecb2-4e8d-a136-17840c0371a0">

      <sources path="src" recursive="true" />
      <headers path="include" recursive="true" includeroot="true" />

      <dependency name="bitcoin-node" version="4.0.0" />

      <compiler standard="20">
        <flag id="Wall" />
        <flag id="Wextra" />
        <!-- <flag id="Wpedantic" /> -->
        <flag id="Wno-reorder" />
        <flag id="Wno-missing-field-initializers" />
        <flag id="Wno-missing-braces" />
        <flag id="Wno-comment" />
        <flag id="Wno-deprecated-copy" />
        <flag id="Wno-mismatched-tags" />
        <!-- <flag id="fvisibility=hidden" /> -->>
      </compiler>

      <linkage>
        <flag id="no_fixup_chains" />
        <flag id="fstack-protector" />
        <flag id="fstack-protector-all" />
      </linkage>

    </library>

    <test name="libbitcoin-server-tests"
      option="test" type="with" default="yes"
      uuid="66a0e586-2e3a-448f-bcd0-348afeb0d5ea">
      <sources path="test" recursive="true" />
    </test>

    <binary name="bitcoin-server"
      option="console" type="with" default="yes"
      install="true"
      uuid="f45b7d90-90bc-41ef-9ad1-9b29256a09fe">
      <sources path="console" />
    </binary>

  </repository>

  <languages>
    <language id="C">
      <sources suffix="c" />
      <headers suffix="h" />
    </language>
    <language id="CXX">
      <sources suffix="cpp" />
      <headers suffix="hpp" />
      <headers suffix="ipp" />
    </language>
  </languages>

  <canonical>
    <compiler>
        <flag id="Wall"
          comment="Enable questionable/easy to avoid error warnings."
          type="private">
          <context language="c" />
          <context language="c++" />
        </flag>
        <flag id="Wextra"
          comment="Enables extra warnings not enabled by -Wall."
          type="private">
          <context language="c" />
          <context language="c++" />
        </flag>
        <flag id="Wpedantic"
          comment="Enables all warnings demanded by strict ISO C/C+."
          type="private">
          <context language="c" />
          <context language="c++" />
        </flag>
        <flag id="Wno-reorder"
          comment="Disallow warning on style order of declarations."
          type="private"
          language="c++" />
        <flag id="Wno-missing-field-initializers"
          comment="Suppress warning for incomplete field initialization."
          type="private"
          language="c++" />
        <flag id="Wno-missing-braces"
          comment="Conform to style."
          type="private"
          language="c++" />
        <flag id="Wno-comment"
          comment="Ignore comments within comments or commenting of backslash extended lines."
          type="private"
          language="c++" />
        <flag id="Wno-deprecated-copy"
          comment="Suppress warning for copy of implicitly generated copy constructor."
          type="private"
          language="c++" />
        <flag id="Wno-ignored-attributes"
          comment="Suppress warning for ignored attributes (arising on template arguments)."
          type="private"
          language="c++" />
        <flag id="Wno-mismatched-tags"
          comment="Conflict in stdlib under clang."
          type="private"
          language="c++"
          compiler="clang" />
        <!-- This varies by dependency build, such as boost. So we do not enforce. -->
        <flag id="fvisibility=hidden"
          comment="Hide internal functions from external libs."
          type="private"
          language="c++"
          compiler="gcc" />
        <flag id="Wno-long-long"
          comment="Allow use of C99 'long long' type."
          type="private"
          language="c" />
        <flag id="fno-var-tracking-assignments"
          comment="Limit delays and warnings."
          type="private"
          language="c++"
          compiler="gcc" />
    </compiler>

      <linkage>
        <flag id="no_fixup_chains"
          comment="Address -undefined dynamic_lookup MacOS error." />
        <flag id="fstack-protector"
          comment="Protect stack." />
        <flag id="fstack-protector-all"
          comment="Protect stack comprehensively." />
      </linkage>
  </canonical>

  <registrar id="dependency">
    <element name="bitcoin-system">
      <cmake namespace="bitcoin"
        package="bitcoin-system"
        target="bitcoin::system" />
    </element>
    <element name="bitcoin-database">
      <cmake namespace="bitcoin"
        package="bitcoin-database"
        target="bitcoin::database" />
    </element>
    <element name="bitcoin-network">
      <cmake namespace="bitcoin"
        package="bitcoin-network"
        target="bitcoin::network" />
    </element>
    <element name="bitcoin-node">
      <cmake namespace="bitcoin"
        package="bitcoin-node"
        target="bitcoin::node" />
    </element>
    <element name="bitcoin-server">
      <cmake namespace="bitcoin"
        package="bitcoin-server"
        target="bitcoin::server" />
    </element>
    <element name="icu">
      <cmake namespace="ICU"
        package="ICU" />
    </element>
    <element name="boost">
      <cmake namespace="Boost"
        package="Boost" />
    </element>
    <element name="secp256k1">
      <cmake namespace="libsecp256k1"
        package="libsecp256k1"
        target="libsecp256k1::secp256k1" />
    </element>
    <element name="dl">
      <cmake namespace="Dl" package="Dl" target="Dl" />
    </element>
    <element name="rt">
      <cmake namespace="Rt" package="Rt" target="Rt" />
    </element>
    <element name="pthread">
      <cmake namespace="Threads"
       package="Threads"
       target="Threads::Threads">
        <set variable="THREAD_PREFER_PTHREAD_FLAG" value="TRUE" />
      </cmake>
    </element>
  </registrar>

  <templates source="version4.xml" resultpath="../output/version4">
    <!-- resultpath provided relative to expected evaluation - libbitcoin-build/process -->
    <template name="CMakeLists.txt.gsl"
      path="cmake"
      outpath="builds/cmake">
      <cmake rootpath="../../" />
    </template>
    <!--<template name="gsl.config.cmake" path="cmake" />-->
  </templates>
</configuration>
